{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
    .scroll-container {
        overflow-y: auto;
        max-height: 400px; /* Adjust the height as needed */
    }
    .task-container {
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
    }
    .list-group-item {
        border: none;
        background-color: #fff;
    }
    .btn-custom {
        width: 100px;
    }
    /* Flip card styles */
    .flip-card {
        background-color: transparent;
        width: 490px;
        height: 314px;
        perspective: 1000px;
        font-family: sans-serif;
    
    }
    .flip-card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.8s;
        transform-style: preserve-3d;
    }
    .flip-card:hover .flip-card-inner {
        transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
        box-shadow: 0 8px 14px 0 rgba(0,0,0,0.2);
        position: absolute;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center; /* Center align items */
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        border: 1px solid rgb(59, 18, 2);
        border-radius: 1rem;
    }
    .flip-card-front {
        background: url("{% static 'img/flip1.jpg' %}") no-repeat center center; /* Front image */
        background-size: cover; /* Ensure the image covers the front */
        color: white; /* Optional: Change text color for better visibility */
        padding: 20px; /* Optional padding for better spacing */
    }
    .flip-card-back {
        background: url("{% static 'img/task_page.avif' %}") no-repeat center center; /* Back image */
        background-size: cover; /* Ensure the image covers the back */
        transform: rotateY(180deg);
    }
    /* Remove hover effects for the back side */
    .flip-card:hover .flip-card-back {
        background: url("{% static 'img/task_page.avif' %}") no-repeat center center; /* Keep the image */
        background-size: cover; /* Ensure it stays covered */
    }
</style>

<div class="col-lg-12">
    <div class="section-container">
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title text-center">Completed Tasks</h5>
                
                {% regroup tasks|dictsort:"assigned_at" by assigned_at|date:"Y-m-d" as grouped_tasks %}
                {% for group in grouped_tasks %}
                <div class="task-container">
                    <h6 class="text-center">{{ group.grouper }}</h6>
                    <ul class="list-group">
                        {% for task in group.list %}
                        {% if task.is_completed %}
                        <div class="flip-card">
                            <div class="flip-card-inner">
                                <!-- Front side -->
                                <div class="flip-card-front"  style="color:black; font-family: 'Times New Roman', Times, serif;">
                                    <p class="title">Name of the Task: {{ task.task_title }}</p>
                                    
                                    <p>Assigned At: {{ task.assigned_at|date:"Y-m-d" }}</p>
                                    
                                    <p>Completed</p>
                                    <p>Hover to View Details</p>
                                </div>
                                <!-- Back side -->
                                <div class="flip-card-back">
                                    <table class="table table-striped" style="margin: 0; color: rgb(50, 14, 1); color:black; font-family: 'Times New Roman', Times, serif;">
                                        <tbody>
                                            <tr>
                                                <th>Task</th>
                                                <td>: {{ task.task_title  }}</td>
                                            </tr>
                                            <tr>
                                                <th>Assigned At</th>
                                                <td>: {{ task.assigned_at|date:"Y-m-d" }}</td>
                                            </tr>
                                            <tr>
                                                <th>Assigned By</th>
                                                <td>: {% if task.assigned_by %} {{ task.assigned_by.emp_name }} {% else %} N/A {% endif %}</td>
                                            </tr>
                                            <tr>
                                                <th>Complete Before</th>
                                                <td>: {{ task.complete_before|date:"Y-m-d" }}</td>
                                            </tr>
                                            <tr>
                                                <th>Status</th>
                                                <td>: Completed</td>
                                            </tr>
                                            <tr>
                                                <th>Document:</th>
                                                <td>: {% if task.document %}
                                                    <a href="{{ task.document.url }}" target="_blank">View Document</a>
                                                {% else %}
                                                    N/A
                                                {% endif %}</td>
                                            </tr>
                                            <tr>
                                                <tr>
                                                    <tr>
                                                        <th>Ratings:</th>
                                                        <td>
                                                            {% if task.ratings.count > 0 %}
                                                                {% for rating in task.ratings.all %}
                                                                    <div class="rating-stars">
                                                                        {% for i in "12345"|make_list %}
                                                                            <span class="star" style="cursor: default;">
                                                                                {% if i|add:0 <= rating.score %}
                                                                                    <i class="fas fa-star" style="color: gold;"></i> <!-- Filled star -->
                                                                                {% else %}
                                                                                    <i class="far fa-star" style="color: lightgoldenrodyellow;"></i> <!-- Faint star -->
                                                                                {% endif %}
                                                                            </span>
                                                                        {% endfor %}
                                                                    </div>
                                                                    
                                                                {% endfor %}
                                                            {% else %}
                                                                No ratings yet.
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    
                                                </tr>
                                                
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                {% empty %}
                <li class="list-group-item">No completed tasks.</li>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endblock %}
